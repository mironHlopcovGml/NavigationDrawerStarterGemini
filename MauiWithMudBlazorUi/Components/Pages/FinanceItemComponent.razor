@using MauiAppWithMudBlazor.Components.Models
@using MudBlazor
<MudPaper class="d-flex flex-grow-1 gap-1 mud-ripple" Elevation="1" Style="@GetItemStyle()">
    <MudPaper Class="flex-none d-flex" Height="64px" Width="40px" Elevation="0">
        <MudIcon Class="item-icon" Icon="@GetIcon()" Size="Size.Large" Color="@GetIconColor()" />
    </MudPaper>
    <MudPaper Class="d-flex flex-wrap flex-grow-1 gap-4" Height="64px" MinWidth="120px" Elevation="0">
        <div style="display: flex; flex-direction: column; justify-content: center;">
            <p class="item-title" style="margin: 0; font-weight: 500; font-size: 14px; line-height: 1.2; max-height: 2.4em; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">@GetItemTitle()</p>
            <p class="item-label" style="margin: 4px 0 0 0; font-size: 12px; color: #666; line-height: 1.2; max-height: 2.4em; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">@GetItemLabel()</p>
        </div>
    </MudPaper>
    <MudPaper Class="flex-none d-flex flex-auto" Height="64px" Width="103px" Elevation="0">
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: flex-end;">
            <p class="info-title" style="margin: 0; font-weight: 600; font-size: 14px; color: @GetSumColor();">@GetFormattedSum()</p>
            <p class="info-label" style="margin: 4px 0 0 0; font-size: 12px; color: #666;">@GetFormattedDate()</p>
        </div>
    </MudPaper>
</MudPaper>

@code {
    [Parameter] public string Icon { get; set; } = string.Empty;
    [Parameter] public string ItemTitle { get; set; } = string.Empty;
    [Parameter] public string ItemLabel { get; set; } = string.Empty;
    [Parameter] public string infoTitle { get; set; } = string.Empty;
    [Parameter] public string infoLabel { get; set; } = string.Empty;
    [Parameter] public FinanceItem? FinanceItem { get; set; }
    [Parameter] public bool IsNewItem { get; set; } = false;

    private string GetIcon()
    {
        if (FinanceItem != null)
            return FinanceItem.DisplayIcon;
        return !string.IsNullOrEmpty(Icon) ? Icon : "@Icons.Material.Filled.Payment";
    }

    private string GetItemTitle()
    {
        if (FinanceItem != null)
            return FinanceItem.DisplayTitle;
        return ItemTitle;
    }

    private string GetItemLabel()
    {
        if (FinanceItem != null)
            return FinanceItem.DisplayDescription;
        return ItemLabel;
    }

    private string GetFormattedSum()
    {
        if (FinanceItem != null)
            return FinanceItem.FormattedSum;
        return infoTitle;
    }

    private string GetFormattedDate()
    {
        if (FinanceItem != null)
            return FinanceItem.FormattedDate;
        return infoLabel;
    }

    private Color GetIconColor()  // Изменен тип возвращаемого значения
    {
        if (FinanceItem != null)
        {
            return FinanceItem.OperationType switch
            {
                OperacionTyps.OPLATA => Color.Error,        // Убраны кавычки
                OperacionTyps.ZACHISLENIE => Color.Success, // Убраны кавычки
                OperacionTyps.NALICHNYE => Color.Warning,   // Убраны кавычки
                OperacionTyps.UNREACHABLE => Color.Default, // Убраны кавычки
                _ => Color.Primary              // Убраны кавычки
            };
        }
        return Color.Primary;  // Убраны кавычки
    }

    private string GetSumColor()
    {
        if (FinanceItem != null)
        {
            return FinanceItem.Sum >= 0 ? "#4caf50" : "#f44336";
        }
        return "#000";
    }

    private string GetItemStyle()
    {
        if (IsNewItem || (FinanceItem?.IsNewDataItem == true))
        {
            return "border-left: 4px solid #2196f3; background-color: rgba(33, 150, 243, 0.05);";
        }
        return "";
    }
}
